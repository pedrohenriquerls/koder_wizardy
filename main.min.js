(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/PedroLima/Development/personal/koder_wizardy/src/js/entities/enemy.js":[function(require,module,exports){
var Utils = require('../utils');
var SkullProfiles = require('../profiles/skulls');

var Enemy = function (sprite) {
  //sprite.body.moves = false;
  sprite.physicsBodyType = Phaser.Physics.ARCADE;
  sprite.body.collideWorldBounds = true

  sprite.target = window.player;

  // Set the pivot point for this sprite to the center
  sprite.anchor.setTo(0.5, 0.5);

  // Enable physics on this object
  sprite.game.physics.enable(sprite, Phaser.Physics.ARCADE);

  // Define constants that affect motion
  sprite.MAX_SPEED = 50; // pixels/second
  sprite.MIN_DISTANCE = 0; // pixels

  sprite.animations.add('walkBottom', [0,1], 10);
  sprite.animations.add('walkTop', [2,3], 10);
  sprite.animations.add('walkRight', [4,5], 10);
  sprite.animations.add('walkLeft', [6,7], 10);
  sprite.animations.add('dead', [8], 0);

  sprite.alive = true
  this.sprite = sprite

  this.profileGenerator()
  var self = this

  sprite.update = function(){
  	if(self.attrsProfile.life <= 0 && this.alive){
      window.globalHud.showFightAction(self.attrsProfile.name, "Has defeated!!")
  		this.alive = false
      sprite.animations.play('dead', 1)
      window.enemyClone.setTexture(sprite.generateTexture())
  		
      setTimeout(function(){
  		  window.enemysKilled++
  		  window.player.clearFightScene()

        sprite.destroy()
      }, 1000)
  	}else{
      var distance = this.game.math.distance(this.x, this.y, this.target.x, this.target.y);
      if(distance <= 45){
        // If the distance > MIN_DISTANCE then move
        if (distance > this.MIN_DISTANCE) {
            // Calculate the angle to the target
            var rotation = this.game.math.angleBetween(this.x, this.y, this.target.x, this.target.y);
            if(rotation > 1)
              this.animations.play('walkBottom', 6);
            else
              this.animations.play('walkTop', 6);

            // Calculate velocity vector based on rotation and this.MAX_SPEED
            this.body.velocity.x = Math.cos(rotation) * this.MAX_SPEED;
            this.body.velocity.y = Math.sin(rotation) * this.MAX_SPEED;
        } else {
            this.body.velocity.setTo(0, 0);
        }
      }else
         this.body.velocity.setTo(0, 0);
    }
  }
}

Enemy.prototype.profileGenerator = function(name){
  var id = Math.round(Utils.rollDice(0, SkullProfiles.length -1))
  var skullProfile = SkullProfiles[id]
	this.attrsProfile = {
    name: skullProfile.name,
    life: skullProfile.life,
    power: skullProfile.power,
    description: skullProfile.description
  }
}

Enemy.prototype.attack = function(callback){
  if(!this.sprite.alive){
    if(callback)
      callback()
    return
  }
    
  window.globalHud.showFightAction(this.attrsProfile.name, "Attack!!")

  var attackOverload = this.attrsProfile.attack
  if(attackOverload){
    attackOverload()
  }else{
    var maxDmg = this.attrsProfile.power
    var dmg = Utils.rollDice(0, maxDmg > 0 ? maxDmg : 1)

    window.player.life -= dmg
  }
  
  window.player.timer.reset()
  if(callback)
    callback()

  window.player.timer.start()
}

module.exports = Enemy;

},{"../profiles/skulls":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/profiles/skulls.js","../utils":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/utils.js"}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/entities/globalHud.js":[function(require,module,exports){
var GlobalHud = function (game, player, enemy) {
	this.game  = game
	this.group = game.add.group();

	this.player = player
	this.enemy  = enemy

	window.globalHud = this
}

GlobalHud.prototype.getStyle = function(){
	return { font: '24px Wizards Magic', fill: '#fff' }
}

GlobalHud.prototype.playerMessage = function(text){
	if(!this.textBox && !this.broadcastText){
		this.textBox = this.game.add.sprite(0, 0, "boxSprite")
		this.textBox.width = 380
		this.textBox.height = 80

		this.textBox.fixedToCamera = true;
	  this.textBox.cameraOffset.setTo(0, 220);

	  var style = this.getStyle()
		style.font = "10px Arial"

	  this.broadcastText = this.game.add.text(0, 0, "", style);
	  this.broadcastText.fixedToCamera = true;
  	this.broadcastText.cameraOffset.setTo(25, 230);

  	this.textBoxGroup = this.game.add.group();

		this.textBoxGroup.add(this.textBox)
		this.textBoxGroup.add(this.broadcastText)

		this.game.add.existing(this.textBoxGroup);
	}
	this.textBoxGroup.alpha = 1
	this.broadcastText.setText(text)
	this.game.add.tween(this.textBoxGroup).to( { alpha: 0 }, 500, Phaser.Easing.Linear.None, true, 2500, 0, false)
}

GlobalHud.prototype.createPlayerHud = function(){
	var style = this.getStyle()
	style.font = "14px Arial"

	console.log(window.player.life)
	this.life = this.game.add.text(0, 10, "Life: "+window.player.life , style);
	this.enemiesKilled = this.game.add.text(0, 10, "Score: "+ window.enemysKilled, style);

	this.life.fixedToCamera = true;
  this.life.cameraOffset.setTo(0, 30);

  this.enemiesKilled.fixedToCamera = true;
  this.enemiesKilled.cameraOffset.setTo(300, 30);
}

GlobalHud.prototype.updatePlayerHud = function(){
	var style = this.getStyle()
	style.font = "14px Arial"

	this.life.setText("Life: "+Math.round(window.player.life))
	this.enemiesKilled.setText("Score: "+ window.enemysKilled)
}

GlobalHud.prototype.showFightAction = function(actorName, actionName){
	var actionText = actorName+': '+ actionName
	if(!this.actions){
		var style = this.getStyle()
		style.align = "center"
		style.font = "16px Arial"
		this.actions = this.game.add.text(0, 0, actionText, style);

		this.actions.fixedToCamera = true;
  	this.actions.cameraOffset.setTo(110, 100);
	}else
		this.actions.setText(actionText)

	var self = this

  this.actions.alpha = 1
  this.game.add.tween(this.actions).to( { alpha: 0 }, 500, Phaser.Easing.Linear.None, true, 1000, 0, false)
}

GlobalHud.prototype.fightHudDestroy = function(){
	this.actions.destroy()
	this.actions = null
}

module.exports = GlobalHud;
},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/entities/player.js":[function(require,module,exports){
var VisualTimer = require('../vendor/VisualTimer');
var FightSystem = require('../states/fight');

var Player = function (game, x, y) {
  Phaser.Sprite.call(this, game, x, y, 'playerSprites');
  game.physics.arcade.enable(this);

  this.body.collideWorldBounds = true

  this.cursors = game.input.keyboard.createCursorKeys();

  game.add.existing(this);
  game.camera.follow(this);

  this.loadAnimations()

  window.enemysKilled = 0

  this.velocity = 60
  this.fps = 6

  this.fighting = false
  this.loadSkills()

  this.playerClone = null
  this.enemyClone = null

  this.life = 100

  window.player = this
}

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
  //player movement

  this.body.velocity.y = 0;
  this.body.velocity.x = 0;

  if(window.player.fighting || this.fighting)
    return

  if(this.cursors.up.isDown) {
    this.body.velocity.y -= this.velocity;
    this.animations.play('walkTop', this.fps);
  }
  else if(this.cursors.down.isDown) {
    this.body.velocity.y += this.velocity;
    this.animations.play('walkBottom', this.fps);
  }
  if(this.cursors.left.isDown) {
    this.body.velocity.x -= this.velocity;
    this.animations.play('walkLeft', this.fps);
  }
  else if(this.cursors.right.isDown) {
    this.body.velocity.x += this.velocity;
    this.animations.play('walkRight', this.fps);
  }
}

Player.prototype.addCollider = function(game, layer){
  game.physics.arcade.collide(this, layer);
}

Player.prototype.loadAnimations = function(){
  this.animations.add('walkBottom', [0,1], 10);
  this.animations.add('walkTop', [2,3], 10);
  this.animations.add('walkRight', [4,5], 10);
  this.animations.add('walkLeft', [6,7], 10);
}

Player.prototype.loadSkills = function(){
  window.playerSkills = {
    debug: function(enemy){
      var style = { font: "10px Arial", fill: "#fff"};
      var game = window.player.game
      var t = game.add.text(0, 0, JSON.stringify(enemy, null, " "), style);
      t.fixedToCamera = true;
      t.cameraOffset.setTo(0, 40);

      game.add.tween(t).to( { alpha: 0 }, 2000, Phaser.Easing.Linear.None, true, 5000, 0, false).onUpdateCallback(function(){
        window.setTimeout(function(){
          t.destroy()  
        }, 2000)
      });
    }
  }
}

Player.prototype.fight = function(player, enemy){
  if(window.player.fighting == true)
    return

  window.player.fighting = true
  
  var game = player.game

  //var arena = new Phaser.Rectangle(150, player.y, 150, 200);
  //arena.fill('#0fffff')
  player.animations.play('walkRight', this.fps);
  window.playerClone = game.add.sprite(0, 0, player.generateTexture());
  window.playerClone.scale.x = window.playerClone.scale.y = 2
  window.playerClone.fixedToCamera = true;
  window.playerClone.cameraOffset.setTo(100, 180);
  
  enemy.animations.play('walkLeft', this.fps);
  window.enemyClone  = game.add.sprite(0, 0, enemy.generateTexture());
  window.enemyClone.scale.x = window.enemyClone.scale.y = 2
  window.enemyClone.fixedToCamera = true;
  window.enemyClone.cameraOffset.setTo(250, 180);

  var fightSystem = new FightSystem(player, enemy)
  fightSystem.createQuest()

  setTimeout(function(){
    window.player.timer = new VisualTimer({
      game: game,
      x: 110,
      y: 20,
      seconds: 30,
      onComplete: function() {
        fightSystem.disableKoderify()
        setTimeout(function(){
          enemy.instance.attack(fightSystem.enableKoderify)
        }, 1000)
      }
    });

    player.visible = false
    enemy.visible = false

    window.currentEnemy = enemy.instance.attrsProfile
    fightSystem.createEditor()

    window.player.timer.start()
  }, 2000)
}

Player.prototype.clearFightScene = function(){
  window.playerClone.destroy()
  window.enemyClone.destroy()
  window.player.timer.destroy()
  this.visible = true
  this.fighting = false
  window.globalHud.fightHudDestroy()
}



module.exports = Player;

},{"../states/fight":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/fight.js","../vendor/VisualTimer":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/vendor/VisualTimer.js"}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'mage-knight-game');

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game'
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('Fight', require('./states/fight'));

game.state.start('Boot');

},{"./states/boot":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/boot.js","./states/fight":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/fight.js","./states/game":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/game.js","./states/menu":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/menu.js","./states/preloader":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/preloader.js","./states/splash":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/splash.js","./utils":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/utils.js"}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/profiles/skulls.js":[function(require,module,exports){
var SkullProfiles = [
	{
		name: "Zombineia",
    life: 20,
    power: 20,
    description: "Human hatred and enjoys long walks in the moonlight."
	},
	{
		name: "ZuZumba",
    life: 20,
    power: 20,
    description: "Like to eat brains."
	},
	{
		name: "Zombirasta",
    life: 20,
    power: 20,
    description: "Eat brains to feel alive again :)."
	},
	{
		name: "Zombie",
    life: 20,
    power: 20,
    description: "Brains!! Your brain is mine."
	},
	{
		name: "Rob Zombe",
    life: 60,
    power: 50,
    description: "It`s a autor of worst songs =S."
	},
	{
		name: "Zigurat",
    life: 10,
    power: 1,
    description: "ZZZzzz."
	}
]

module.exports = SkullProfiles
},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/profiles/tutorials.js":[function(require,module,exports){
var Tutorials = [
	'Yoda about JS: The Javascript a powerful ally it is. Brendan creates it,\n makes it grow. Its energy surrounds us and binds us. Objects beings are\nwe, not this crude matter. You must debug the Objects around you; here,\nbetween you, me, the nodejs, the jquery, everywhere, yes.\n',
	'Like Yoda told ya, this first fight is only about objects, try debug\nyour enemies(debug(enemy)).\nFind a away to defeat him, using the power of Javascript.\n Tip: enemy.name = "blastoise"\n'
]

module.exports = Tutorials
},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    if (this.game.device.desktop) {
      this.scale.scaleMode = Phaser.ScaleManager.EXACT_FIT;
      //this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.scale.setGameSize(400, 300);
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    //physics system
    this.game.physics.startSystem(Phaser.Physics.ARCADE);

    this.game.state.start('Preloader');
  }
};

},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/fight.js":[function(require,module,exports){
var Tutorials = require('../profiles/tutorials');
var FightSystem = function (player, enemy) {
  this.player = player
  this.enemy  = enemy
}
var suggestions = [
  {name: 'if', value: 'if', score: '1', meta: 'keyword'},
  {name: 'else', value: 'else', score: '1', meta: 'keyword'},
  {name: 'for', value: 'for', score: '1', meta: 'keyword'},
  {name: 'switch', value: 'switch', score: '1', meta: 'keyword'},
  {name: 'case', value: 'case', score: '1', meta: 'keyword'},
];
var executeLabel = null
FightSystem.prototype.createEditor = function(){
  ace.require("ace/ext/language_tools");
  this.editor = ace.edit("editor");
  this.editor.setOptions({enableBasicAutocompletion: true});
  this.editor.setFocus = function(){
    this.focus()
    session = this.getSession();
    var count = session.getLength();
    //Go to end of the last line
    this.gotoLine(count, session.getLine(count-1).length);
  }

  var completer = {
    getCompletions: function(editor, session, pos, prefix, callback) {
      for (var param in window.playerSkills) {
        if (window.playerSkills.hasOwnProperty(param)) {
          suggestions.push({name: param, value: param, score: '1', meta: 'spell'});
        }
      }
      callback(null, suggestions);
    }
  };

  this.editor.completers = [completer];
  this.editor.getSession().setMode("ace/mode/javascript");
  window.editor = this.editor;

  executeLabel = this.player.game.add.text(0, 0, 'Koderify!!', { font: '24px Wizards Magic', fill: '#fff' });
  executeLabel.inputEnabled = true;
  executeLabel.events.onInputUp.add(this.execute)
  
  executeLabel.fixedToCamera = true;
  executeLabel.cameraOffset.setTo(280, 260);
  //this.executeLabel = executeLabel

	if(this.editor.getValue().trim() == "")
  	this.basicCode()
}

FightSystem.prototype.createQuest = function(){
  var text = Tutorials[window.enemysKilled + 1]
  if(text)
    window.globalHud.playerMessage(text)
}

FightSystem.prototype.enableKoderify = function() {
  //window.editor.setFocus()
  executeLabel.inputEnabled = true
  executeLabel.setStyle({font: '24px Wizards Magic', fill: '#fff'});

}

FightSystem.prototype.disableKoderify = function() {
  executeLabel.inputEnabled = false
  executeLabel.setStyle({font: '24px Wizards Magic', fill: '#777'});
}

FightSystem.prototype.execute = function(){
	var self = this
	var code = this.editor.getValue();

	var worldThings = {
		enemy: self.currentEnemy,
		skills: self.playerSkills,
    debug: new Object(self.playerSkills.debug),
    window: {},
    document: {}
	}

	var params = [];
  var args = [];

  var sadboxMock = Object.create(null);

  for (var param in worldThings) {
    if (worldThings.hasOwnProperty(param)) {
      args.push(worldThings[param]);
      params.push(param);
    }
  }

  var context = Array.prototype.concat.call(sadboxMock, params, code); // create the parameter list for the sandbox
  var sandbox = new (Function.prototype.bind.apply(Function, context)); // create the sandbox function
  context = Array.prototype.concat.call(sadboxMock, args); // create the argument list for the sandbox

  var sandboxFunction = Function.prototype.bind.apply(sandbox, context); // bind the local variables to the sandbox
  try{
    sandboxFunction()  
  }catch(e){
    window.globalHud.playerMessage("Error: "+e)
  }
  
}

FightSystem.prototype.basicCode = function(){
	this.editor.insert("//You are the greater master of creation and destruction here\n")
  this.editor.insert("//Change enemies attributes and create new spells\n")
  this.editor.insert("//Ctrl+Space for use the power of autocomplete\n")
  this.editor.insert("")
  this.editor.setFocus()
}

module.exports = FightSystem;
},{"../profiles/tutorials":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/profiles/tutorials.js"}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/game.js":[function(require,module,exports){
var Player = require('../entities/player');
var Enemy = require('../entities/enemy');
var GlobalHud    = require('../entities/globalHud');
var Tutorials = require('../profiles/tutorials');

var Game = function () {
  this.player = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    this.map = this.game.add.tilemap('level1');

    this.map.addTilesetImage('stone_bricks', 'scenarioSprites');
    this.map.addTilesetImage('weapons_spells_torch_key_gems', 'objectsSprites');
    this.map.addTilesetImage('Players', 'playerSprites');
    this.map.addTilesetImage('monsters', 'monstersSprites');

    //create layer
    this.groundLayer = this.map.createLayer('groundLayer');
    this.blockedLayer = this.map.createLayer('blockedLayer');
    
    //collision on blockedLayer
    this.map.setCollisionBetween(1, 2000, true, 'blockedLayer');

    var playerPosition = this.findObjectsByType('playerStart', this.map, 'playerLayer')
    this.player = new Player(this.game, playerPosition[0].x, playerPosition[0].y)  

    /** Spawning Skulls **/
    this.skulls = this.game.add.group();

    this.skulls.enableBody = true;
    this.skulls.instances = []

    var skulls = this.findObjectsByType('skull', this.map, 'enemiesLayer')
    skulls.forEach(function(skull){
      var _skull = this.skulls.create(skull.x, skull.y, "monstersSprites")

      Object.keys(skull.properties).forEach(function(key){
        _skull[key] = skull.properties[key];
      });
      _skull.instance = new Enemy(_skull)
    }, this)
    
    this.blockedLayer.resizeWorld();

    this.shadowTexture = this.game.add.bitmapData(this.game.width, this.game.height);
    this.lightSprite = this.game.add.image(this.game.camera.x, this.game.camera.y, this.shadowTexture);

    this.lightSprite.blendMode = Phaser.blendModes.MULTIPLY;

    this.globalHud = new GlobalHud(this.game, this.player)
    this.globalHud.createPlayerHud()

    window.globalHud.playerMessage(Tutorials[0])
  },

  update: function(){
    if(window.player.life <= 0){
      //window.player.destroy()
      var t = this.game.add.text(0, 0, "Game Over", { font: "30px Arial", fill: "#fff"});
      t.fixedToCamera = true;
      t.cameraOffset.setTo(100, 150);

      var self = this

      setTimeout(function(){
        self.game.state.start("Menu");
      }, 500)
    }


    this.player.addCollider(this.game, this.blockedLayer)
    this.game.physics.arcade.overlap(this.player, this.skulls, this.player.fight, null, this);
    this.globalHud.updatePlayerHud()

    this.updateShadowTexture();   
    this.lightSprite.reset(this.game.camera.x, this.game.camera.y);
  },
  updateShadowTexture: function(){
    // Draw shadow
    this.shadowTexture.context.fillStyle = 'rgb(10, 10, 10)';
    this.shadowTexture.context.fillRect(0, 0, this.game.width, this.game.height);

    var radius = 50 + this.game.rnd.integerInRange(1,5),
        heroX = this.player.x - this.game.camera.x + 9,
        heroY = this.player.y - this.game.camera.y + 10;
    if(this.player.fighting){
      heroX = heroY = 1000
    }
   
    // Draw circle of light with a soft edge
    var gradient =
        this.shadowTexture.context.createRadialGradient(
            heroX, heroY, 40 * 0.75,
            heroX, heroY, radius);
    gradient.addColorStop(0, 'rgba(255, 255, 255, 1.0)');
    gradient.addColorStop(1, 'rgba(255, 255, 255, 0.0)');

    this.shadowTexture.context.beginPath();
    this.shadowTexture.context.fillStyle = gradient;
    this.shadowTexture.context.arc(heroX, heroY, radius, 0, Math.PI*2, false);
    this.shadowTexture.context.fill();

    this.shadowTexture.dirty = true;
  },

  findObjectsByType: function(type, map, layer) {
    var result = new Array();
    map.objects[layer].forEach(function(element){
      if(element.properties.type === type) {
        element.y -= map.tileHeight;
        result.push(element);
      }      
    });
    return result;
  }
};

},{"../entities/enemy":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/entities/enemy.js","../entities/globalHud":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/entities/globalHud.js","../entities/player":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/entities/player.js","../profiles/tutorials":"/Users/PedroLima/Development/personal/koder_wizardy/src/js/profiles/tutorials.js"}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;
    this.stage.backgroundColor = '#4b0049'

    var title = this.add.text(40, 20, "Koder Wizardy", { font: "50px Wizards Magic", fill: "#ffffff", align: "center" });

    var start = this.add.text(140, 200, "Press to Start", { font: "16px Wizards Magic", fill: "#ffffff", align: "center" });
    //var instructions = this.add.text(150, 250, "Instructions", { font: "16px Wizards Magic", fill: "#ffffff", align: "center" });
    
    //start.inputEnabled = true
    //start.events.onInputUp.add(this.onDown)
    this.input.onDown.add(this.onDown, this);

    //instructions.inputEnabled = true
    //instructions.events.onInputUp.add(this.gotoInstructions)
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start("Game");
  },
  gotoInstructions: function(){
    
  }
};

},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(100, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    //this.load.image('testsprite', 'assets/test.png');

    this.load.tilemap('level1', 'assets/maps/first_map.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('scenarioSprites', 'assets/images/blockLayer/stone_bricks.png');
    this.load.image('objectsSprites', 'assets/images/weapons_spells_torch_key_gems.png');
    this.load.image('boxSprite', 'assets/images/gui/box-highres.png');

    this.load.spritesheet('playerSprites', 'assets/images/players-mages.png', 16, 16);
    this.load.spritesheet('monstersSprites', 'assets/images/zombie.png', 16, 16);
    this.load.spritesheet('timer', 'assets/images/timer.png', 150, 20);
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },
    rollDice: function(min, max){
    	return Math.round(Math.random() * (max - min) + min)
    }

};

module.exports = Utils;
},{}],"/Users/PedroLima/Development/personal/koder_wizardy/src/js/vendor/VisualTimer.js":[function(require,module,exports){

var timerTick = function() {
		/*jshint validthis:true */
		if(!this.timer)
			return
		var myTime = (this.type == 'down') ? this.remainingTime() : this.timer.seconds;
		this.rect.width = Math.max(0, (myTime / this.totalTime) * this.fullWidth);
		this.sprite.crop(this.rect);
	}

var VisualTimer = function(opts) {
		this.destroyed = false
		this.type = 'down';
		if (opts.type) {
			this.type = opts.type;
		}
		this.totalTime = opts.seconds;
		this.game = opts.game;
		this.onComplete = opts.onComplete;
		var key = 'timer';
		if (opts.key) {
			key = opts.key;
		}
		this.empty = this.game.add.sprite(0, 0, key, 1);
		this.empty.fixedToCamera = true;
  	this.empty.cameraOffset.setTo(opts.x, opts.y);

		this.sprite = this.game.add.sprite(0, 0, key, 0);
		this.sprite.fixedToCamera = true;
  	this.sprite.cameraOffset.setTo(opts.x, opts.y);
		
		this.fullWidth = this.sprite.width;
		this.reset();
	}

	VisualTimer.prototype = {
		reset: function() {
			console.log(this.destroyed)
			if(this.destroyed)
				return

			if (this.timer) {
				this.timer.stop();
			}

			var self = this;
			this.hasFinished = false;
			this.timer = this.game.time.create(true);
			this.timer.repeat(Phaser.Timer.SECOND, this.totalTime, timerTick, this);
			this.timer.onComplete.add(function() {
				self.hasFinished = true;
				if (self.onComplete) {
					self.onComplete();
				}
			});
			this.rect = new Phaser.Rectangle(0, 0, 0, this.sprite.height);
			if (this.type == 'down') {
				this.sprite.crop(null);
			} else {
				this.sprite.crop(this.rect);
			}
		},

		destroy: function(){
			this.timer = null
			this.destroyed = true

			this.sprite.destroy()
			this.empty.destroy()
		},

		setTime: function(seconds) {
			this.totalTime = seconds;
			this.reset();
		},

		start: function() {
			if(this.destroyed)
				return
			this.reset();
			this.timer.start();
		},

		stop: function() {
			this.timer.stop();
		},

		pause: function() {
			this.timer.pause();
		},

		resume: function() {
			this.timer.resume();
		},

		remainingTime: function() {
			return this.totalTime - this.timer.seconds;
		}
	};


	


module.exports = VisualTimer;

},{}]},{},["/Users/PedroLima/Development/personal/koder_wizardy/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50aXRpZXMvZW5lbXkuanMiLCJzcmMvanMvZW50aXRpZXMvZ2xvYmFsSHVkLmpzIiwic3JjL2pzL2VudGl0aWVzL3BsYXllci5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3Byb2ZpbGVzL3NrdWxscy5qcyIsInNyYy9qcy9wcm9maWxlcy90dXRvcmlhbHMuanMiLCJzcmMvanMvc3RhdGVzL2Jvb3QuanMiLCJzcmMvanMvc3RhdGVzL2ZpZ2h0LmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwic3JjL2pzL3N0YXRlcy9tZW51LmpzIiwic3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCJzcmMvanMvc3RhdGVzL3NwbGFzaC5qcyIsInNyYy9qcy91dGlscy5qcyIsInNyYy9qcy92ZW5kb3IvVmlzdWFsVGltZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIFNrdWxsUHJvZmlsZXMgPSByZXF1aXJlKCcuLi9wcm9maWxlcy9za3VsbHMnKTtcblxudmFyIEVuZW15ID0gZnVuY3Rpb24gKHNwcml0ZSkge1xuICAvL3Nwcml0ZS5ib2R5Lm1vdmVzID0gZmFsc2U7XG4gIHNwcml0ZS5waHlzaWNzQm9keVR5cGUgPSBQaGFzZXIuUGh5c2ljcy5BUkNBREU7XG4gIHNwcml0ZS5ib2R5LmNvbGxpZGVXb3JsZEJvdW5kcyA9IHRydWVcblxuICBzcHJpdGUudGFyZ2V0ID0gd2luZG93LnBsYXllcjtcblxuICAvLyBTZXQgdGhlIHBpdm90IHBvaW50IGZvciB0aGlzIHNwcml0ZSB0byB0aGUgY2VudGVyXG4gIHNwcml0ZS5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gIC8vIEVuYWJsZSBwaHlzaWNzIG9uIHRoaXMgb2JqZWN0XG4gIHNwcml0ZS5nYW1lLnBoeXNpY3MuZW5hYmxlKHNwcml0ZSwgUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcblxuICAvLyBEZWZpbmUgY29uc3RhbnRzIHRoYXQgYWZmZWN0IG1vdGlvblxuICBzcHJpdGUuTUFYX1NQRUVEID0gNTA7IC8vIHBpeGVscy9zZWNvbmRcbiAgc3ByaXRlLk1JTl9ESVNUQU5DRSA9IDA7IC8vIHBpeGVsc1xuXG4gIHNwcml0ZS5hbmltYXRpb25zLmFkZCgnd2Fsa0JvdHRvbScsIFswLDFdLCAxMCk7XG4gIHNwcml0ZS5hbmltYXRpb25zLmFkZCgnd2Fsa1RvcCcsIFsyLDNdLCAxMCk7XG4gIHNwcml0ZS5hbmltYXRpb25zLmFkZCgnd2Fsa1JpZ2h0JywgWzQsNV0sIDEwKTtcbiAgc3ByaXRlLmFuaW1hdGlvbnMuYWRkKCd3YWxrTGVmdCcsIFs2LDddLCAxMCk7XG4gIHNwcml0ZS5hbmltYXRpb25zLmFkZCgnZGVhZCcsIFs4XSwgMCk7XG5cbiAgc3ByaXRlLmFsaXZlID0gdHJ1ZVxuICB0aGlzLnNwcml0ZSA9IHNwcml0ZVxuXG4gIHRoaXMucHJvZmlsZUdlbmVyYXRvcigpXG4gIHZhciBzZWxmID0gdGhpc1xuXG4gIHNwcml0ZS51cGRhdGUgPSBmdW5jdGlvbigpe1xuICBcdGlmKHNlbGYuYXR0cnNQcm9maWxlLmxpZmUgPD0gMCAmJiB0aGlzLmFsaXZlKXtcbiAgICAgIHdpbmRvdy5nbG9iYWxIdWQuc2hvd0ZpZ2h0QWN0aW9uKHNlbGYuYXR0cnNQcm9maWxlLm5hbWUsIFwiSGFzIGRlZmVhdGVkISFcIilcbiAgXHRcdHRoaXMuYWxpdmUgPSBmYWxzZVxuICAgICAgc3ByaXRlLmFuaW1hdGlvbnMucGxheSgnZGVhZCcsIDEpXG4gICAgICB3aW5kb3cuZW5lbXlDbG9uZS5zZXRUZXh0dXJlKHNwcml0ZS5nZW5lcmF0ZVRleHR1cmUoKSlcbiAgXHRcdFxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICBcdFx0ICB3aW5kb3cuZW5lbXlzS2lsbGVkKytcbiAgXHRcdCAgd2luZG93LnBsYXllci5jbGVhckZpZ2h0U2NlbmUoKVxuXG4gICAgICAgIHNwcml0ZS5kZXN0cm95KClcbiAgICAgIH0sIDEwMDApXG4gIFx0fWVsc2V7XG4gICAgICB2YXIgZGlzdGFuY2UgPSB0aGlzLmdhbWUubWF0aC5kaXN0YW5jZSh0aGlzLngsIHRoaXMueSwgdGhpcy50YXJnZXQueCwgdGhpcy50YXJnZXQueSk7XG4gICAgICBpZihkaXN0YW5jZSA8PSA0NSl7XG4gICAgICAgIC8vIElmIHRoZSBkaXN0YW5jZSA+IE1JTl9ESVNUQU5DRSB0aGVuIG1vdmVcbiAgICAgICAgaWYgKGRpc3RhbmNlID4gdGhpcy5NSU5fRElTVEFOQ0UpIHtcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYW5nbGUgdG8gdGhlIHRhcmdldFxuICAgICAgICAgICAgdmFyIHJvdGF0aW9uID0gdGhpcy5nYW1lLm1hdGguYW5nbGVCZXR3ZWVuKHRoaXMueCwgdGhpcy55LCB0aGlzLnRhcmdldC54LCB0aGlzLnRhcmdldC55KTtcbiAgICAgICAgICAgIGlmKHJvdGF0aW9uID4gMSlcbiAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25zLnBsYXkoJ3dhbGtCb3R0b20nLCA2KTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb25zLnBsYXkoJ3dhbGtUb3AnLCA2KTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHZlbG9jaXR5IHZlY3RvciBiYXNlZCBvbiByb3RhdGlvbiBhbmQgdGhpcy5NQVhfU1BFRURcbiAgICAgICAgICAgIHRoaXMuYm9keS52ZWxvY2l0eS54ID0gTWF0aC5jb3Mocm90YXRpb24pICogdGhpcy5NQVhfU1BFRUQ7XG4gICAgICAgICAgICB0aGlzLmJvZHkudmVsb2NpdHkueSA9IE1hdGguc2luKHJvdGF0aW9uKSAqIHRoaXMuTUFYX1NQRUVEO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnNldFRvKDAsIDApO1xuICAgICAgICB9XG4gICAgICB9ZWxzZVxuICAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnNldFRvKDAsIDApO1xuICAgIH1cbiAgfVxufVxuXG5FbmVteS5wcm90b3R5cGUucHJvZmlsZUdlbmVyYXRvciA9IGZ1bmN0aW9uKG5hbWUpe1xuICB2YXIgaWQgPSBNYXRoLnJvdW5kKFV0aWxzLnJvbGxEaWNlKDAsIFNrdWxsUHJvZmlsZXMubGVuZ3RoIC0xKSlcbiAgdmFyIHNrdWxsUHJvZmlsZSA9IFNrdWxsUHJvZmlsZXNbaWRdXG5cdHRoaXMuYXR0cnNQcm9maWxlID0ge1xuICAgIG5hbWU6IHNrdWxsUHJvZmlsZS5uYW1lLFxuICAgIGxpZmU6IHNrdWxsUHJvZmlsZS5saWZlLFxuICAgIHBvd2VyOiBza3VsbFByb2ZpbGUucG93ZXIsXG4gICAgZGVzY3JpcHRpb246IHNrdWxsUHJvZmlsZS5kZXNjcmlwdGlvblxuICB9XG59XG5cbkVuZW15LnByb3RvdHlwZS5hdHRhY2sgPSBmdW5jdGlvbihjYWxsYmFjayl7XG4gIGlmKCF0aGlzLnNwcml0ZS5hbGl2ZSl7XG4gICAgaWYoY2FsbGJhY2spXG4gICAgICBjYWxsYmFjaygpXG4gICAgcmV0dXJuXG4gIH1cbiAgICBcbiAgd2luZG93Lmdsb2JhbEh1ZC5zaG93RmlnaHRBY3Rpb24odGhpcy5hdHRyc1Byb2ZpbGUubmFtZSwgXCJBdHRhY2shIVwiKVxuXG4gIHZhciBhdHRhY2tPdmVybG9hZCA9IHRoaXMuYXR0cnNQcm9maWxlLmF0dGFja1xuICBpZihhdHRhY2tPdmVybG9hZCl7XG4gICAgYXR0YWNrT3ZlcmxvYWQoKVxuICB9ZWxzZXtcbiAgICB2YXIgbWF4RG1nID0gdGhpcy5hdHRyc1Byb2ZpbGUucG93ZXJcbiAgICB2YXIgZG1nID0gVXRpbHMucm9sbERpY2UoMCwgbWF4RG1nID4gMCA/IG1heERtZyA6IDEpXG5cbiAgICB3aW5kb3cucGxheWVyLmxpZmUgLT0gZG1nXG4gIH1cbiAgXG4gIHdpbmRvdy5wbGF5ZXIudGltZXIucmVzZXQoKVxuICBpZihjYWxsYmFjaylcbiAgICBjYWxsYmFjaygpXG5cbiAgd2luZG93LnBsYXllci50aW1lci5zdGFydCgpXG59XG5cbm1vZHVsZS5leHBvcnRzID0gRW5lbXk7XG4iLCJ2YXIgR2xvYmFsSHVkID0gZnVuY3Rpb24gKGdhbWUsIHBsYXllciwgZW5lbXkpIHtcblx0dGhpcy5nYW1lICA9IGdhbWVcblx0dGhpcy5ncm91cCA9IGdhbWUuYWRkLmdyb3VwKCk7XG5cblx0dGhpcy5wbGF5ZXIgPSBwbGF5ZXJcblx0dGhpcy5lbmVteSAgPSBlbmVteVxuXG5cdHdpbmRvdy5nbG9iYWxIdWQgPSB0aGlzXG59XG5cbkdsb2JhbEh1ZC5wcm90b3R5cGUuZ2V0U3R5bGUgPSBmdW5jdGlvbigpe1xuXHRyZXR1cm4geyBmb250OiAnMjRweCBXaXphcmRzIE1hZ2ljJywgZmlsbDogJyNmZmYnIH1cbn1cblxuR2xvYmFsSHVkLnByb3RvdHlwZS5wbGF5ZXJNZXNzYWdlID0gZnVuY3Rpb24odGV4dCl7XG5cdGlmKCF0aGlzLnRleHRCb3ggJiYgIXRoaXMuYnJvYWRjYXN0VGV4dCl7XG5cdFx0dGhpcy50ZXh0Qm94ID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoMCwgMCwgXCJib3hTcHJpdGVcIilcblx0XHR0aGlzLnRleHRCb3gud2lkdGggPSAzODBcblx0XHR0aGlzLnRleHRCb3guaGVpZ2h0ID0gODBcblxuXHRcdHRoaXMudGV4dEJveC5maXhlZFRvQ2FtZXJhID0gdHJ1ZTtcblx0ICB0aGlzLnRleHRCb3guY2FtZXJhT2Zmc2V0LnNldFRvKDAsIDIyMCk7XG5cblx0ICB2YXIgc3R5bGUgPSB0aGlzLmdldFN0eWxlKClcblx0XHRzdHlsZS5mb250ID0gXCIxMHB4IEFyaWFsXCJcblxuXHQgIHRoaXMuYnJvYWRjYXN0VGV4dCA9IHRoaXMuZ2FtZS5hZGQudGV4dCgwLCAwLCBcIlwiLCBzdHlsZSk7XG5cdCAgdGhpcy5icm9hZGNhc3RUZXh0LmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICBcdHRoaXMuYnJvYWRjYXN0VGV4dC5jYW1lcmFPZmZzZXQuc2V0VG8oMjUsIDIzMCk7XG5cbiAgXHR0aGlzLnRleHRCb3hHcm91cCA9IHRoaXMuZ2FtZS5hZGQuZ3JvdXAoKTtcblxuXHRcdHRoaXMudGV4dEJveEdyb3VwLmFkZCh0aGlzLnRleHRCb3gpXG5cdFx0dGhpcy50ZXh0Qm94R3JvdXAuYWRkKHRoaXMuYnJvYWRjYXN0VGV4dClcblxuXHRcdHRoaXMuZ2FtZS5hZGQuZXhpc3RpbmcodGhpcy50ZXh0Qm94R3JvdXApO1xuXHR9XG5cdHRoaXMudGV4dEJveEdyb3VwLmFscGhhID0gMVxuXHR0aGlzLmJyb2FkY2FzdFRleHQuc2V0VGV4dCh0ZXh0KVxuXHR0aGlzLmdhbWUuYWRkLnR3ZWVuKHRoaXMudGV4dEJveEdyb3VwKS50byggeyBhbHBoYTogMCB9LCA1MDAsIFBoYXNlci5FYXNpbmcuTGluZWFyLk5vbmUsIHRydWUsIDI1MDAsIDAsIGZhbHNlKVxufVxuXG5HbG9iYWxIdWQucHJvdG90eXBlLmNyZWF0ZVBsYXllckh1ZCA9IGZ1bmN0aW9uKCl7XG5cdHZhciBzdHlsZSA9IHRoaXMuZ2V0U3R5bGUoKVxuXHRzdHlsZS5mb250ID0gXCIxNHB4IEFyaWFsXCJcblxuXHRjb25zb2xlLmxvZyh3aW5kb3cucGxheWVyLmxpZmUpXG5cdHRoaXMubGlmZSA9IHRoaXMuZ2FtZS5hZGQudGV4dCgwLCAxMCwgXCJMaWZlOiBcIit3aW5kb3cucGxheWVyLmxpZmUgLCBzdHlsZSk7XG5cdHRoaXMuZW5lbWllc0tpbGxlZCA9IHRoaXMuZ2FtZS5hZGQudGV4dCgwLCAxMCwgXCJTY29yZTogXCIrIHdpbmRvdy5lbmVteXNLaWxsZWQsIHN0eWxlKTtcblxuXHR0aGlzLmxpZmUuZml4ZWRUb0NhbWVyYSA9IHRydWU7XG4gIHRoaXMubGlmZS5jYW1lcmFPZmZzZXQuc2V0VG8oMCwgMzApO1xuXG4gIHRoaXMuZW5lbWllc0tpbGxlZC5maXhlZFRvQ2FtZXJhID0gdHJ1ZTtcbiAgdGhpcy5lbmVtaWVzS2lsbGVkLmNhbWVyYU9mZnNldC5zZXRUbygzMDAsIDMwKTtcbn1cblxuR2xvYmFsSHVkLnByb3RvdHlwZS51cGRhdGVQbGF5ZXJIdWQgPSBmdW5jdGlvbigpe1xuXHR2YXIgc3R5bGUgPSB0aGlzLmdldFN0eWxlKClcblx0c3R5bGUuZm9udCA9IFwiMTRweCBBcmlhbFwiXG5cblx0dGhpcy5saWZlLnNldFRleHQoXCJMaWZlOiBcIitNYXRoLnJvdW5kKHdpbmRvdy5wbGF5ZXIubGlmZSkpXG5cdHRoaXMuZW5lbWllc0tpbGxlZC5zZXRUZXh0KFwiU2NvcmU6IFwiKyB3aW5kb3cuZW5lbXlzS2lsbGVkKVxufVxuXG5HbG9iYWxIdWQucHJvdG90eXBlLnNob3dGaWdodEFjdGlvbiA9IGZ1bmN0aW9uKGFjdG9yTmFtZSwgYWN0aW9uTmFtZSl7XG5cdHZhciBhY3Rpb25UZXh0ID0gYWN0b3JOYW1lKyc6ICcrIGFjdGlvbk5hbWVcblx0aWYoIXRoaXMuYWN0aW9ucyl7XG5cdFx0dmFyIHN0eWxlID0gdGhpcy5nZXRTdHlsZSgpXG5cdFx0c3R5bGUuYWxpZ24gPSBcImNlbnRlclwiXG5cdFx0c3R5bGUuZm9udCA9IFwiMTZweCBBcmlhbFwiXG5cdFx0dGhpcy5hY3Rpb25zID0gdGhpcy5nYW1lLmFkZC50ZXh0KDAsIDAsIGFjdGlvblRleHQsIHN0eWxlKTtcblxuXHRcdHRoaXMuYWN0aW9ucy5maXhlZFRvQ2FtZXJhID0gdHJ1ZTtcbiAgXHR0aGlzLmFjdGlvbnMuY2FtZXJhT2Zmc2V0LnNldFRvKDExMCwgMTAwKTtcblx0fWVsc2Vcblx0XHR0aGlzLmFjdGlvbnMuc2V0VGV4dChhY3Rpb25UZXh0KVxuXG5cdHZhciBzZWxmID0gdGhpc1xuXG4gIHRoaXMuYWN0aW9ucy5hbHBoYSA9IDFcbiAgdGhpcy5nYW1lLmFkZC50d2Vlbih0aGlzLmFjdGlvbnMpLnRvKCB7IGFscGhhOiAwIH0sIDUwMCwgUGhhc2VyLkVhc2luZy5MaW5lYXIuTm9uZSwgdHJ1ZSwgMTAwMCwgMCwgZmFsc2UpXG59XG5cbkdsb2JhbEh1ZC5wcm90b3R5cGUuZmlnaHRIdWREZXN0cm95ID0gZnVuY3Rpb24oKXtcblx0dGhpcy5hY3Rpb25zLmRlc3Ryb3koKVxuXHR0aGlzLmFjdGlvbnMgPSBudWxsXG59XG5cbm1vZHVsZS5leHBvcnRzID0gR2xvYmFsSHVkOyIsInZhciBWaXN1YWxUaW1lciA9IHJlcXVpcmUoJy4uL3ZlbmRvci9WaXN1YWxUaW1lcicpO1xudmFyIEZpZ2h0U3lzdGVtID0gcmVxdWlyZSgnLi4vc3RhdGVzL2ZpZ2h0Jyk7XG5cbnZhciBQbGF5ZXIgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xuICBQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgJ3BsYXllclNwcml0ZXMnKTtcbiAgZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGUodGhpcyk7XG5cbiAgdGhpcy5ib2R5LmNvbGxpZGVXb3JsZEJvdW5kcyA9IHRydWVcblxuICB0aGlzLmN1cnNvcnMgPSBnYW1lLmlucHV0LmtleWJvYXJkLmNyZWF0ZUN1cnNvcktleXMoKTtcblxuICBnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcbiAgZ2FtZS5jYW1lcmEuZm9sbG93KHRoaXMpO1xuXG4gIHRoaXMubG9hZEFuaW1hdGlvbnMoKVxuXG4gIHdpbmRvdy5lbmVteXNLaWxsZWQgPSAwXG5cbiAgdGhpcy52ZWxvY2l0eSA9IDYwXG4gIHRoaXMuZnBzID0gNlxuXG4gIHRoaXMuZmlnaHRpbmcgPSBmYWxzZVxuICB0aGlzLmxvYWRTa2lsbHMoKVxuXG4gIHRoaXMucGxheWVyQ2xvbmUgPSBudWxsXG4gIHRoaXMuZW5lbXlDbG9uZSA9IG51bGxcblxuICB0aGlzLmxpZmUgPSAxMDBcblxuICB3aW5kb3cucGxheWVyID0gdGhpc1xufVxuXG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAvL3BsYXllciBtb3ZlbWVudFxuXG4gIHRoaXMuYm9keS52ZWxvY2l0eS55ID0gMDtcbiAgdGhpcy5ib2R5LnZlbG9jaXR5LnggPSAwO1xuXG4gIGlmKHdpbmRvdy5wbGF5ZXIuZmlnaHRpbmcgfHwgdGhpcy5maWdodGluZylcbiAgICByZXR1cm5cblxuICBpZih0aGlzLmN1cnNvcnMudXAuaXNEb3duKSB7XG4gICAgdGhpcy5ib2R5LnZlbG9jaXR5LnkgLT0gdGhpcy52ZWxvY2l0eTtcbiAgICB0aGlzLmFuaW1hdGlvbnMucGxheSgnd2Fsa1RvcCcsIHRoaXMuZnBzKTtcbiAgfVxuICBlbHNlIGlmKHRoaXMuY3Vyc29ycy5kb3duLmlzRG93bikge1xuICAgIHRoaXMuYm9keS52ZWxvY2l0eS55ICs9IHRoaXMudmVsb2NpdHk7XG4gICAgdGhpcy5hbmltYXRpb25zLnBsYXkoJ3dhbGtCb3R0b20nLCB0aGlzLmZwcyk7XG4gIH1cbiAgaWYodGhpcy5jdXJzb3JzLmxlZnQuaXNEb3duKSB7XG4gICAgdGhpcy5ib2R5LnZlbG9jaXR5LnggLT0gdGhpcy52ZWxvY2l0eTtcbiAgICB0aGlzLmFuaW1hdGlvbnMucGxheSgnd2Fsa0xlZnQnLCB0aGlzLmZwcyk7XG4gIH1cbiAgZWxzZSBpZih0aGlzLmN1cnNvcnMucmlnaHQuaXNEb3duKSB7XG4gICAgdGhpcy5ib2R5LnZlbG9jaXR5LnggKz0gdGhpcy52ZWxvY2l0eTtcbiAgICB0aGlzLmFuaW1hdGlvbnMucGxheSgnd2Fsa1JpZ2h0JywgdGhpcy5mcHMpO1xuICB9XG59XG5cblBsYXllci5wcm90b3R5cGUuYWRkQ29sbGlkZXIgPSBmdW5jdGlvbihnYW1lLCBsYXllcil7XG4gIGdhbWUucGh5c2ljcy5hcmNhZGUuY29sbGlkZSh0aGlzLCBsYXllcik7XG59XG5cblBsYXllci5wcm90b3R5cGUubG9hZEFuaW1hdGlvbnMgPSBmdW5jdGlvbigpe1xuICB0aGlzLmFuaW1hdGlvbnMuYWRkKCd3YWxrQm90dG9tJywgWzAsMV0sIDEwKTtcbiAgdGhpcy5hbmltYXRpb25zLmFkZCgnd2Fsa1RvcCcsIFsyLDNdLCAxMCk7XG4gIHRoaXMuYW5pbWF0aW9ucy5hZGQoJ3dhbGtSaWdodCcsIFs0LDVdLCAxMCk7XG4gIHRoaXMuYW5pbWF0aW9ucy5hZGQoJ3dhbGtMZWZ0JywgWzYsN10sIDEwKTtcbn1cblxuUGxheWVyLnByb3RvdHlwZS5sb2FkU2tpbGxzID0gZnVuY3Rpb24oKXtcbiAgd2luZG93LnBsYXllclNraWxscyA9IHtcbiAgICBkZWJ1ZzogZnVuY3Rpb24oZW5lbXkpe1xuICAgICAgdmFyIHN0eWxlID0geyBmb250OiBcIjEwcHggQXJpYWxcIiwgZmlsbDogXCIjZmZmXCJ9O1xuICAgICAgdmFyIGdhbWUgPSB3aW5kb3cucGxheWVyLmdhbWVcbiAgICAgIHZhciB0ID0gZ2FtZS5hZGQudGV4dCgwLCAwLCBKU09OLnN0cmluZ2lmeShlbmVteSwgbnVsbCwgXCIgXCIpLCBzdHlsZSk7XG4gICAgICB0LmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICAgICAgdC5jYW1lcmFPZmZzZXQuc2V0VG8oMCwgNDApO1xuXG4gICAgICBnYW1lLmFkZC50d2Vlbih0KS50byggeyBhbHBoYTogMCB9LCAyMDAwLCBQaGFzZXIuRWFzaW5nLkxpbmVhci5Ob25lLCB0cnVlLCA1MDAwLCAwLCBmYWxzZSkub25VcGRhdGVDYWxsYmFjayhmdW5jdGlvbigpe1xuICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgIHQuZGVzdHJveSgpICBcbiAgICAgICAgfSwgMjAwMClcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5QbGF5ZXIucHJvdG90eXBlLmZpZ2h0ID0gZnVuY3Rpb24ocGxheWVyLCBlbmVteSl7XG4gIGlmKHdpbmRvdy5wbGF5ZXIuZmlnaHRpbmcgPT0gdHJ1ZSlcbiAgICByZXR1cm5cblxuICB3aW5kb3cucGxheWVyLmZpZ2h0aW5nID0gdHJ1ZVxuICBcbiAgdmFyIGdhbWUgPSBwbGF5ZXIuZ2FtZVxuXG4gIC8vdmFyIGFyZW5hID0gbmV3IFBoYXNlci5SZWN0YW5nbGUoMTUwLCBwbGF5ZXIueSwgMTUwLCAyMDApO1xuICAvL2FyZW5hLmZpbGwoJyMwZmZmZmYnKVxuICBwbGF5ZXIuYW5pbWF0aW9ucy5wbGF5KCd3YWxrUmlnaHQnLCB0aGlzLmZwcyk7XG4gIHdpbmRvdy5wbGF5ZXJDbG9uZSA9IGdhbWUuYWRkLnNwcml0ZSgwLCAwLCBwbGF5ZXIuZ2VuZXJhdGVUZXh0dXJlKCkpO1xuICB3aW5kb3cucGxheWVyQ2xvbmUuc2NhbGUueCA9IHdpbmRvdy5wbGF5ZXJDbG9uZS5zY2FsZS55ID0gMlxuICB3aW5kb3cucGxheWVyQ2xvbmUuZml4ZWRUb0NhbWVyYSA9IHRydWU7XG4gIHdpbmRvdy5wbGF5ZXJDbG9uZS5jYW1lcmFPZmZzZXQuc2V0VG8oMTAwLCAxODApO1xuICBcbiAgZW5lbXkuYW5pbWF0aW9ucy5wbGF5KCd3YWxrTGVmdCcsIHRoaXMuZnBzKTtcbiAgd2luZG93LmVuZW15Q2xvbmUgID0gZ2FtZS5hZGQuc3ByaXRlKDAsIDAsIGVuZW15LmdlbmVyYXRlVGV4dHVyZSgpKTtcbiAgd2luZG93LmVuZW15Q2xvbmUuc2NhbGUueCA9IHdpbmRvdy5lbmVteUNsb25lLnNjYWxlLnkgPSAyXG4gIHdpbmRvdy5lbmVteUNsb25lLmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICB3aW5kb3cuZW5lbXlDbG9uZS5jYW1lcmFPZmZzZXQuc2V0VG8oMjUwLCAxODApO1xuXG4gIHZhciBmaWdodFN5c3RlbSA9IG5ldyBGaWdodFN5c3RlbShwbGF5ZXIsIGVuZW15KVxuICBmaWdodFN5c3RlbS5jcmVhdGVRdWVzdCgpXG5cbiAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgIHdpbmRvdy5wbGF5ZXIudGltZXIgPSBuZXcgVmlzdWFsVGltZXIoe1xuICAgICAgZ2FtZTogZ2FtZSxcbiAgICAgIHg6IDExMCxcbiAgICAgIHk6IDIwLFxuICAgICAgc2Vjb25kczogMzAsXG4gICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgZmlnaHRTeXN0ZW0uZGlzYWJsZUtvZGVyaWZ5KClcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgIGVuZW15Lmluc3RhbmNlLmF0dGFjayhmaWdodFN5c3RlbS5lbmFibGVLb2RlcmlmeSlcbiAgICAgICAgfSwgMTAwMClcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHBsYXllci52aXNpYmxlID0gZmFsc2VcbiAgICBlbmVteS52aXNpYmxlID0gZmFsc2VcblxuICAgIHdpbmRvdy5jdXJyZW50RW5lbXkgPSBlbmVteS5pbnN0YW5jZS5hdHRyc1Byb2ZpbGVcbiAgICBmaWdodFN5c3RlbS5jcmVhdGVFZGl0b3IoKVxuXG4gICAgd2luZG93LnBsYXllci50aW1lci5zdGFydCgpXG4gIH0sIDIwMDApXG59XG5cblBsYXllci5wcm90b3R5cGUuY2xlYXJGaWdodFNjZW5lID0gZnVuY3Rpb24oKXtcbiAgd2luZG93LnBsYXllckNsb25lLmRlc3Ryb3koKVxuICB3aW5kb3cuZW5lbXlDbG9uZS5kZXN0cm95KClcbiAgd2luZG93LnBsYXllci50aW1lci5kZXN0cm95KClcbiAgdGhpcy52aXNpYmxlID0gdHJ1ZVxuICB0aGlzLmZpZ2h0aW5nID0gZmFsc2VcbiAgd2luZG93Lmdsb2JhbEh1ZC5maWdodEh1ZERlc3Ryb3koKVxufVxuXG5cblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDgwMCwgNjAwLCBQaGFzZXIuQVVUTywgJ21hZ2Uta25pZ2h0LWdhbWUnKTtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXG59XG5cbmdhbWUuc3RhdGUuYWRkKCdCb290JywgcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdTcGxhc2gnLCByZXF1aXJlKCcuL3N0YXRlcy9zcGxhc2gnKSk7XG5nYW1lLnN0YXRlLmFkZCgnUHJlbG9hZGVyJywgcmVxdWlyZSgnLi9zdGF0ZXMvcHJlbG9hZGVyJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ01lbnUnLCByZXF1aXJlKCcuL3N0YXRlcy9tZW51JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWUnLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0ZpZ2h0JywgcmVxdWlyZSgnLi9zdGF0ZXMvZmlnaHQnKSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiIsInZhciBTa3VsbFByb2ZpbGVzID0gW1xuXHR7XG5cdFx0bmFtZTogXCJab21iaW5laWFcIixcbiAgICBsaWZlOiAyMCxcbiAgICBwb3dlcjogMjAsXG4gICAgZGVzY3JpcHRpb246IFwiSHVtYW4gaGF0cmVkIGFuZCBlbmpveXMgbG9uZyB3YWxrcyBpbiB0aGUgbW9vbmxpZ2h0LlwiXG5cdH0sXG5cdHtcblx0XHRuYW1lOiBcIlp1WnVtYmFcIixcbiAgICBsaWZlOiAyMCxcbiAgICBwb3dlcjogMjAsXG4gICAgZGVzY3JpcHRpb246IFwiTGlrZSB0byBlYXQgYnJhaW5zLlwiXG5cdH0sXG5cdHtcblx0XHRuYW1lOiBcIlpvbWJpcmFzdGFcIixcbiAgICBsaWZlOiAyMCxcbiAgICBwb3dlcjogMjAsXG4gICAgZGVzY3JpcHRpb246IFwiRWF0IGJyYWlucyB0byBmZWVsIGFsaXZlIGFnYWluIDopLlwiXG5cdH0sXG5cdHtcblx0XHRuYW1lOiBcIlpvbWJpZVwiLFxuICAgIGxpZmU6IDIwLFxuICAgIHBvd2VyOiAyMCxcbiAgICBkZXNjcmlwdGlvbjogXCJCcmFpbnMhISBZb3VyIGJyYWluIGlzIG1pbmUuXCJcblx0fSxcblx0e1xuXHRcdG5hbWU6IFwiUm9iIFpvbWJlXCIsXG4gICAgbGlmZTogNjAsXG4gICAgcG93ZXI6IDUwLFxuICAgIGRlc2NyaXB0aW9uOiBcIkl0YHMgYSBhdXRvciBvZiB3b3JzdCBzb25ncyA9Uy5cIlxuXHR9LFxuXHR7XG5cdFx0bmFtZTogXCJaaWd1cmF0XCIsXG4gICAgbGlmZTogMTAsXG4gICAgcG93ZXI6IDEsXG4gICAgZGVzY3JpcHRpb246IFwiWlpaenp6LlwiXG5cdH1cbl1cblxubW9kdWxlLmV4cG9ydHMgPSBTa3VsbFByb2ZpbGVzIiwidmFyIFR1dG9yaWFscyA9IFtcblx0J1lvZGEgYWJvdXQgSlM6IFRoZSBKYXZhc2NyaXB0IGEgcG93ZXJmdWwgYWxseSBpdCBpcy4gQnJlbmRhbiBjcmVhdGVzIGl0LFxcbiBtYWtlcyBpdCBncm93LiBJdHMgZW5lcmd5IHN1cnJvdW5kcyB1cyBhbmQgYmluZHMgdXMuIE9iamVjdHMgYmVpbmdzIGFyZVxcbndlLCBub3QgdGhpcyBjcnVkZSBtYXR0ZXIuIFlvdSBtdXN0IGRlYnVnIHRoZSBPYmplY3RzIGFyb3VuZCB5b3U7IGhlcmUsXFxuYmV0d2VlbiB5b3UsIG1lLCB0aGUgbm9kZWpzLCB0aGUganF1ZXJ5LCBldmVyeXdoZXJlLCB5ZXMuXFxuJyxcblx0J0xpa2UgWW9kYSB0b2xkIHlhLCB0aGlzIGZpcnN0IGZpZ2h0IGlzIG9ubHkgYWJvdXQgb2JqZWN0cywgdHJ5IGRlYnVnXFxueW91ciBlbmVtaWVzKGRlYnVnKGVuZW15KSkuXFxuRmluZCBhIGF3YXkgdG8gZGVmZWF0IGhpbSwgdXNpbmcgdGhlIHBvd2VyIG9mIEphdmFzY3JpcHQuXFxuIFRpcDogZW5lbXkubmFtZSA9IFwiYmxhc3RvaXNlXCJcXG4nXG5dXG5cbm1vZHVsZS5leHBvcnRzID0gVHV0b3JpYWxzIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XG4gICAgICB0aGlzLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuRVhBQ1RfRklUO1xuICAgICAgLy90aGlzLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICB0aGlzLnNjYWxlLnNldEdhbWVTaXplKDQwMCwgMzAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlTW9kZSA9IFBoYXNlci5TdGFnZVNjYWxlTW9kZS5TSE9XX0FMTDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5taW5XaWR0aCA9ICA0ODA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWluSGVpZ2h0ID0gMjYwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5mb3JjZUxhbmRzY2FwZSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgIH1cblxuICAgIC8vcGh5c2ljcyBzeXN0ZW1cbiAgICB0aGlzLmdhbWUucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsInZhciBUdXRvcmlhbHMgPSByZXF1aXJlKCcuLi9wcm9maWxlcy90dXRvcmlhbHMnKTtcbnZhciBGaWdodFN5c3RlbSA9IGZ1bmN0aW9uIChwbGF5ZXIsIGVuZW15KSB7XG4gIHRoaXMucGxheWVyID0gcGxheWVyXG4gIHRoaXMuZW5lbXkgID0gZW5lbXlcbn1cbnZhciBzdWdnZXN0aW9ucyA9IFtcbiAge25hbWU6ICdpZicsIHZhbHVlOiAnaWYnLCBzY29yZTogJzEnLCBtZXRhOiAna2V5d29yZCd9LFxuICB7bmFtZTogJ2Vsc2UnLCB2YWx1ZTogJ2Vsc2UnLCBzY29yZTogJzEnLCBtZXRhOiAna2V5d29yZCd9LFxuICB7bmFtZTogJ2ZvcicsIHZhbHVlOiAnZm9yJywgc2NvcmU6ICcxJywgbWV0YTogJ2tleXdvcmQnfSxcbiAge25hbWU6ICdzd2l0Y2gnLCB2YWx1ZTogJ3N3aXRjaCcsIHNjb3JlOiAnMScsIG1ldGE6ICdrZXl3b3JkJ30sXG4gIHtuYW1lOiAnY2FzZScsIHZhbHVlOiAnY2FzZScsIHNjb3JlOiAnMScsIG1ldGE6ICdrZXl3b3JkJ30sXG5dO1xudmFyIGV4ZWN1dGVMYWJlbCA9IG51bGxcbkZpZ2h0U3lzdGVtLnByb3RvdHlwZS5jcmVhdGVFZGl0b3IgPSBmdW5jdGlvbigpe1xuICBhY2UucmVxdWlyZShcImFjZS9leHQvbGFuZ3VhZ2VfdG9vbHNcIik7XG4gIHRoaXMuZWRpdG9yID0gYWNlLmVkaXQoXCJlZGl0b3JcIik7XG4gIHRoaXMuZWRpdG9yLnNldE9wdGlvbnMoe2VuYWJsZUJhc2ljQXV0b2NvbXBsZXRpb246IHRydWV9KTtcbiAgdGhpcy5lZGl0b3Iuc2V0Rm9jdXMgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuZm9jdXMoKVxuICAgIHNlc3Npb24gPSB0aGlzLmdldFNlc3Npb24oKTtcbiAgICB2YXIgY291bnQgPSBzZXNzaW9uLmdldExlbmd0aCgpO1xuICAgIC8vR28gdG8gZW5kIG9mIHRoZSBsYXN0IGxpbmVcbiAgICB0aGlzLmdvdG9MaW5lKGNvdW50LCBzZXNzaW9uLmdldExpbmUoY291bnQtMSkubGVuZ3RoKTtcbiAgfVxuXG4gIHZhciBjb21wbGV0ZXIgPSB7XG4gICAgZ2V0Q29tcGxldGlvbnM6IGZ1bmN0aW9uKGVkaXRvciwgc2Vzc2lvbiwgcG9zLCBwcmVmaXgsIGNhbGxiYWNrKSB7XG4gICAgICBmb3IgKHZhciBwYXJhbSBpbiB3aW5kb3cucGxheWVyU2tpbGxzKSB7XG4gICAgICAgIGlmICh3aW5kb3cucGxheWVyU2tpbGxzLmhhc093blByb3BlcnR5KHBhcmFtKSkge1xuICAgICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goe25hbWU6IHBhcmFtLCB2YWx1ZTogcGFyYW0sIHNjb3JlOiAnMScsIG1ldGE6ICdzcGVsbCd9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FsbGJhY2sobnVsbCwgc3VnZ2VzdGlvbnMpO1xuICAgIH1cbiAgfTtcblxuICB0aGlzLmVkaXRvci5jb21wbGV0ZXJzID0gW2NvbXBsZXRlcl07XG4gIHRoaXMuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRNb2RlKFwiYWNlL21vZGUvamF2YXNjcmlwdFwiKTtcbiAgd2luZG93LmVkaXRvciA9IHRoaXMuZWRpdG9yO1xuXG4gIGV4ZWN1dGVMYWJlbCA9IHRoaXMucGxheWVyLmdhbWUuYWRkLnRleHQoMCwgMCwgJ0tvZGVyaWZ5ISEnLCB7IGZvbnQ6ICcyNHB4IFdpemFyZHMgTWFnaWMnLCBmaWxsOiAnI2ZmZicgfSk7XG4gIGV4ZWN1dGVMYWJlbC5pbnB1dEVuYWJsZWQgPSB0cnVlO1xuICBleGVjdXRlTGFiZWwuZXZlbnRzLm9uSW5wdXRVcC5hZGQodGhpcy5leGVjdXRlKVxuICBcbiAgZXhlY3V0ZUxhYmVsLmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICBleGVjdXRlTGFiZWwuY2FtZXJhT2Zmc2V0LnNldFRvKDI4MCwgMjYwKTtcbiAgLy90aGlzLmV4ZWN1dGVMYWJlbCA9IGV4ZWN1dGVMYWJlbFxuXG5cdGlmKHRoaXMuZWRpdG9yLmdldFZhbHVlKCkudHJpbSgpID09IFwiXCIpXG4gIFx0dGhpcy5iYXNpY0NvZGUoKVxufVxuXG5GaWdodFN5c3RlbS5wcm90b3R5cGUuY3JlYXRlUXVlc3QgPSBmdW5jdGlvbigpe1xuICB2YXIgdGV4dCA9IFR1dG9yaWFsc1t3aW5kb3cuZW5lbXlzS2lsbGVkICsgMV1cbiAgaWYodGV4dClcbiAgICB3aW5kb3cuZ2xvYmFsSHVkLnBsYXllck1lc3NhZ2UodGV4dClcbn1cblxuRmlnaHRTeXN0ZW0ucHJvdG90eXBlLmVuYWJsZUtvZGVyaWZ5ID0gZnVuY3Rpb24oKSB7XG4gIC8vd2luZG93LmVkaXRvci5zZXRGb2N1cygpXG4gIGV4ZWN1dGVMYWJlbC5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gIGV4ZWN1dGVMYWJlbC5zZXRTdHlsZSh7Zm9udDogJzI0cHggV2l6YXJkcyBNYWdpYycsIGZpbGw6ICcjZmZmJ30pO1xuXG59XG5cbkZpZ2h0U3lzdGVtLnByb3RvdHlwZS5kaXNhYmxlS29kZXJpZnkgPSBmdW5jdGlvbigpIHtcbiAgZXhlY3V0ZUxhYmVsLmlucHV0RW5hYmxlZCA9IGZhbHNlXG4gIGV4ZWN1dGVMYWJlbC5zZXRTdHlsZSh7Zm9udDogJzI0cHggV2l6YXJkcyBNYWdpYycsIGZpbGw6ICcjNzc3J30pO1xufVxuXG5GaWdodFN5c3RlbS5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uKCl7XG5cdHZhciBzZWxmID0gdGhpc1xuXHR2YXIgY29kZSA9IHRoaXMuZWRpdG9yLmdldFZhbHVlKCk7XG5cblx0dmFyIHdvcmxkVGhpbmdzID0ge1xuXHRcdGVuZW15OiBzZWxmLmN1cnJlbnRFbmVteSxcblx0XHRza2lsbHM6IHNlbGYucGxheWVyU2tpbGxzLFxuICAgIGRlYnVnOiBuZXcgT2JqZWN0KHNlbGYucGxheWVyU2tpbGxzLmRlYnVnKSxcbiAgICB3aW5kb3c6IHt9LFxuICAgIGRvY3VtZW50OiB7fVxuXHR9XG5cblx0dmFyIHBhcmFtcyA9IFtdO1xuICB2YXIgYXJncyA9IFtdO1xuXG4gIHZhciBzYWRib3hNb2NrID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICBmb3IgKHZhciBwYXJhbSBpbiB3b3JsZFRoaW5ncykge1xuICAgIGlmICh3b3JsZFRoaW5ncy5oYXNPd25Qcm9wZXJ0eShwYXJhbSkpIHtcbiAgICAgIGFyZ3MucHVzaCh3b3JsZFRoaW5nc1twYXJhbV0pO1xuICAgICAgcGFyYW1zLnB1c2gocGFyYW0pO1xuICAgIH1cbiAgfVxuXG4gIHZhciBjb250ZXh0ID0gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5jYWxsKHNhZGJveE1vY2ssIHBhcmFtcywgY29kZSk7IC8vIGNyZWF0ZSB0aGUgcGFyYW1ldGVyIGxpc3QgZm9yIHRoZSBzYW5kYm94XG4gIHZhciBzYW5kYm94ID0gbmV3IChGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5hcHBseShGdW5jdGlvbiwgY29udGV4dCkpOyAvLyBjcmVhdGUgdGhlIHNhbmRib3ggZnVuY3Rpb25cbiAgY29udGV4dCA9IEFycmF5LnByb3RvdHlwZS5jb25jYXQuY2FsbChzYWRib3hNb2NrLCBhcmdzKTsgLy8gY3JlYXRlIHRoZSBhcmd1bWVudCBsaXN0IGZvciB0aGUgc2FuZGJveFxuXG4gIHZhciBzYW5kYm94RnVuY3Rpb24gPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5hcHBseShzYW5kYm94LCBjb250ZXh0KTsgLy8gYmluZCB0aGUgbG9jYWwgdmFyaWFibGVzIHRvIHRoZSBzYW5kYm94XG4gIHRyeXtcbiAgICBzYW5kYm94RnVuY3Rpb24oKSAgXG4gIH1jYXRjaChlKXtcbiAgICB3aW5kb3cuZ2xvYmFsSHVkLnBsYXllck1lc3NhZ2UoXCJFcnJvcjogXCIrZSlcbiAgfVxuICBcbn1cblxuRmlnaHRTeXN0ZW0ucHJvdG90eXBlLmJhc2ljQ29kZSA9IGZ1bmN0aW9uKCl7XG5cdHRoaXMuZWRpdG9yLmluc2VydChcIi8vWW91IGFyZSB0aGUgZ3JlYXRlciBtYXN0ZXIgb2YgY3JlYXRpb24gYW5kIGRlc3RydWN0aW9uIGhlcmVcXG5cIilcbiAgdGhpcy5lZGl0b3IuaW5zZXJ0KFwiLy9DaGFuZ2UgZW5lbWllcyBhdHRyaWJ1dGVzIGFuZCBjcmVhdGUgbmV3IHNwZWxsc1xcblwiKVxuICB0aGlzLmVkaXRvci5pbnNlcnQoXCIvL0N0cmwrU3BhY2UgZm9yIHVzZSB0aGUgcG93ZXIgb2YgYXV0b2NvbXBsZXRlXFxuXCIpXG4gIHRoaXMuZWRpdG9yLmluc2VydChcIlwiKVxuICB0aGlzLmVkaXRvci5zZXRGb2N1cygpXG59XG5cbm1vZHVsZS5leHBvcnRzID0gRmlnaHRTeXN0ZW07IiwidmFyIFBsYXllciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL3BsYXllcicpO1xudmFyIEVuZW15ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvZW5lbXknKTtcbnZhciBHbG9iYWxIdWQgICAgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9nbG9iYWxIdWQnKTtcbnZhciBUdXRvcmlhbHMgPSByZXF1aXJlKCcuLi9wcm9maWxlcy90dXRvcmlhbHMnKTtcblxudmFyIEdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMucGxheWVyID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcblxuR2FtZS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tYXAgPSB0aGlzLmdhbWUuYWRkLnRpbGVtYXAoJ2xldmVsMScpO1xuXG4gICAgdGhpcy5tYXAuYWRkVGlsZXNldEltYWdlKCdzdG9uZV9icmlja3MnLCAnc2NlbmFyaW9TcHJpdGVzJyk7XG4gICAgdGhpcy5tYXAuYWRkVGlsZXNldEltYWdlKCd3ZWFwb25zX3NwZWxsc190b3JjaF9rZXlfZ2VtcycsICdvYmplY3RzU3ByaXRlcycpO1xuICAgIHRoaXMubWFwLmFkZFRpbGVzZXRJbWFnZSgnUGxheWVycycsICdwbGF5ZXJTcHJpdGVzJyk7XG4gICAgdGhpcy5tYXAuYWRkVGlsZXNldEltYWdlKCdtb25zdGVycycsICdtb25zdGVyc1Nwcml0ZXMnKTtcblxuICAgIC8vY3JlYXRlIGxheWVyXG4gICAgdGhpcy5ncm91bmRMYXllciA9IHRoaXMubWFwLmNyZWF0ZUxheWVyKCdncm91bmRMYXllcicpO1xuICAgIHRoaXMuYmxvY2tlZExheWVyID0gdGhpcy5tYXAuY3JlYXRlTGF5ZXIoJ2Jsb2NrZWRMYXllcicpO1xuICAgIFxuICAgIC8vY29sbGlzaW9uIG9uIGJsb2NrZWRMYXllclxuICAgIHRoaXMubWFwLnNldENvbGxpc2lvbkJldHdlZW4oMSwgMjAwMCwgdHJ1ZSwgJ2Jsb2NrZWRMYXllcicpO1xuXG4gICAgdmFyIHBsYXllclBvc2l0aW9uID0gdGhpcy5maW5kT2JqZWN0c0J5VHlwZSgncGxheWVyU3RhcnQnLCB0aGlzLm1hcCwgJ3BsYXllckxheWVyJylcbiAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIodGhpcy5nYW1lLCBwbGF5ZXJQb3NpdGlvblswXS54LCBwbGF5ZXJQb3NpdGlvblswXS55KSAgXG5cbiAgICAvKiogU3Bhd25pbmcgU2t1bGxzICoqL1xuICAgIHRoaXMuc2t1bGxzID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpO1xuXG4gICAgdGhpcy5za3VsbHMuZW5hYmxlQm9keSA9IHRydWU7XG4gICAgdGhpcy5za3VsbHMuaW5zdGFuY2VzID0gW11cblxuICAgIHZhciBza3VsbHMgPSB0aGlzLmZpbmRPYmplY3RzQnlUeXBlKCdza3VsbCcsIHRoaXMubWFwLCAnZW5lbWllc0xheWVyJylcbiAgICBza3VsbHMuZm9yRWFjaChmdW5jdGlvbihza3VsbCl7XG4gICAgICB2YXIgX3NrdWxsID0gdGhpcy5za3VsbHMuY3JlYXRlKHNrdWxsLngsIHNrdWxsLnksIFwibW9uc3RlcnNTcHJpdGVzXCIpXG5cbiAgICAgIE9iamVjdC5rZXlzKHNrdWxsLnByb3BlcnRpZXMpLmZvckVhY2goZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgX3NrdWxsW2tleV0gPSBza3VsbC5wcm9wZXJ0aWVzW2tleV07XG4gICAgICB9KTtcbiAgICAgIF9za3VsbC5pbnN0YW5jZSA9IG5ldyBFbmVteShfc2t1bGwpXG4gICAgfSwgdGhpcylcbiAgICBcbiAgICB0aGlzLmJsb2NrZWRMYXllci5yZXNpemVXb3JsZCgpO1xuXG4gICAgdGhpcy5zaGFkb3dUZXh0dXJlID0gdGhpcy5nYW1lLmFkZC5iaXRtYXBEYXRhKHRoaXMuZ2FtZS53aWR0aCwgdGhpcy5nYW1lLmhlaWdodCk7XG4gICAgdGhpcy5saWdodFNwcml0ZSA9IHRoaXMuZ2FtZS5hZGQuaW1hZ2UodGhpcy5nYW1lLmNhbWVyYS54LCB0aGlzLmdhbWUuY2FtZXJhLnksIHRoaXMuc2hhZG93VGV4dHVyZSk7XG5cbiAgICB0aGlzLmxpZ2h0U3ByaXRlLmJsZW5kTW9kZSA9IFBoYXNlci5ibGVuZE1vZGVzLk1VTFRJUExZO1xuXG4gICAgdGhpcy5nbG9iYWxIdWQgPSBuZXcgR2xvYmFsSHVkKHRoaXMuZ2FtZSwgdGhpcy5wbGF5ZXIpXG4gICAgdGhpcy5nbG9iYWxIdWQuY3JlYXRlUGxheWVySHVkKClcblxuICAgIHdpbmRvdy5nbG9iYWxIdWQucGxheWVyTWVzc2FnZShUdXRvcmlhbHNbMF0pXG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbigpe1xuICAgIGlmKHdpbmRvdy5wbGF5ZXIubGlmZSA8PSAwKXtcbiAgICAgIC8vd2luZG93LnBsYXllci5kZXN0cm95KClcbiAgICAgIHZhciB0ID0gdGhpcy5nYW1lLmFkZC50ZXh0KDAsIDAsIFwiR2FtZSBPdmVyXCIsIHsgZm9udDogXCIzMHB4IEFyaWFsXCIsIGZpbGw6IFwiI2ZmZlwifSk7XG4gICAgICB0LmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICAgICAgdC5jYW1lcmFPZmZzZXQuc2V0VG8oMTAwLCAxNTApO1xuXG4gICAgICB2YXIgc2VsZiA9IHRoaXNcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICBzZWxmLmdhbWUuc3RhdGUuc3RhcnQoXCJNZW51XCIpO1xuICAgICAgfSwgNTAwKVxuICAgIH1cblxuXG4gICAgdGhpcy5wbGF5ZXIuYWRkQ29sbGlkZXIodGhpcy5nYW1lLCB0aGlzLmJsb2NrZWRMYXllcilcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUub3ZlcmxhcCh0aGlzLnBsYXllciwgdGhpcy5za3VsbHMsIHRoaXMucGxheWVyLmZpZ2h0LCBudWxsLCB0aGlzKTtcbiAgICB0aGlzLmdsb2JhbEh1ZC51cGRhdGVQbGF5ZXJIdWQoKVxuXG4gICAgdGhpcy51cGRhdGVTaGFkb3dUZXh0dXJlKCk7ICAgXG4gICAgdGhpcy5saWdodFNwcml0ZS5yZXNldCh0aGlzLmdhbWUuY2FtZXJhLngsIHRoaXMuZ2FtZS5jYW1lcmEueSk7XG4gIH0sXG4gIHVwZGF0ZVNoYWRvd1RleHR1cmU6IGZ1bmN0aW9uKCl7XG4gICAgLy8gRHJhdyBzaGFkb3dcbiAgICB0aGlzLnNoYWRvd1RleHR1cmUuY29udGV4dC5maWxsU3R5bGUgPSAncmdiKDEwLCAxMCwgMTApJztcbiAgICB0aGlzLnNoYWRvd1RleHR1cmUuY29udGV4dC5maWxsUmVjdCgwLCAwLCB0aGlzLmdhbWUud2lkdGgsIHRoaXMuZ2FtZS5oZWlnaHQpO1xuXG4gICAgdmFyIHJhZGl1cyA9IDUwICsgdGhpcy5nYW1lLnJuZC5pbnRlZ2VySW5SYW5nZSgxLDUpLFxuICAgICAgICBoZXJvWCA9IHRoaXMucGxheWVyLnggLSB0aGlzLmdhbWUuY2FtZXJhLnggKyA5LFxuICAgICAgICBoZXJvWSA9IHRoaXMucGxheWVyLnkgLSB0aGlzLmdhbWUuY2FtZXJhLnkgKyAxMDtcbiAgICBpZih0aGlzLnBsYXllci5maWdodGluZyl7XG4gICAgICBoZXJvWCA9IGhlcm9ZID0gMTAwMFxuICAgIH1cbiAgIFxuICAgIC8vIERyYXcgY2lyY2xlIG9mIGxpZ2h0IHdpdGggYSBzb2Z0IGVkZ2VcbiAgICB2YXIgZ3JhZGllbnQgPVxuICAgICAgICB0aGlzLnNoYWRvd1RleHR1cmUuY29udGV4dC5jcmVhdGVSYWRpYWxHcmFkaWVudChcbiAgICAgICAgICAgIGhlcm9YLCBoZXJvWSwgNDAgKiAwLjc1LFxuICAgICAgICAgICAgaGVyb1gsIGhlcm9ZLCByYWRpdXMpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAxLjApJyk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMCknKTtcblxuICAgIHRoaXMuc2hhZG93VGV4dHVyZS5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgIHRoaXMuc2hhZG93VGV4dHVyZS5jb250ZXh0LmZpbGxTdHlsZSA9IGdyYWRpZW50O1xuICAgIHRoaXMuc2hhZG93VGV4dHVyZS5jb250ZXh0LmFyYyhoZXJvWCwgaGVyb1ksIHJhZGl1cywgMCwgTWF0aC5QSSoyLCBmYWxzZSk7XG4gICAgdGhpcy5zaGFkb3dUZXh0dXJlLmNvbnRleHQuZmlsbCgpO1xuXG4gICAgdGhpcy5zaGFkb3dUZXh0dXJlLmRpcnR5ID0gdHJ1ZTtcbiAgfSxcblxuICBmaW5kT2JqZWN0c0J5VHlwZTogZnVuY3Rpb24odHlwZSwgbWFwLCBsYXllcikge1xuICAgIHZhciByZXN1bHQgPSBuZXcgQXJyYXkoKTtcbiAgICBtYXAub2JqZWN0c1tsYXllcl0uZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgIGlmKGVsZW1lbnQucHJvcGVydGllcy50eXBlID09PSB0eXBlKSB7XG4gICAgICAgIGVsZW1lbnQueSAtPSBtYXAudGlsZUhlaWdodDtcbiAgICAgICAgcmVzdWx0LnB1c2goZWxlbWVudCk7XG4gICAgICB9ICAgICAgXG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufTtcbiIsInZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnRleHQgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XG4gICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcbiAgICB0aGlzLnN0YWdlLmJhY2tncm91bmRDb2xvciA9ICcjNGIwMDQ5J1xuXG4gICAgdmFyIHRpdGxlID0gdGhpcy5hZGQudGV4dCg0MCwgMjAsIFwiS29kZXIgV2l6YXJkeVwiLCB7IGZvbnQ6IFwiNTBweCBXaXphcmRzIE1hZ2ljXCIsIGZpbGw6IFwiI2ZmZmZmZlwiLCBhbGlnbjogXCJjZW50ZXJcIiB9KTtcblxuICAgIHZhciBzdGFydCA9IHRoaXMuYWRkLnRleHQoMTQwLCAyMDAsIFwiUHJlc3MgdG8gU3RhcnRcIiwgeyBmb250OiBcIjE2cHggV2l6YXJkcyBNYWdpY1wiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfSk7XG4gICAgLy92YXIgaW5zdHJ1Y3Rpb25zID0gdGhpcy5hZGQudGV4dCgxNTAsIDI1MCwgXCJJbnN0cnVjdGlvbnNcIiwgeyBmb250OiBcIjE2cHggV2l6YXJkcyBNYWdpY1wiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfSk7XG4gICAgXG4gICAgLy9zdGFydC5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgLy9zdGFydC5ldmVudHMub25JbnB1dFVwLmFkZCh0aGlzLm9uRG93bilcbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuXG4gICAgLy9pbnN0cnVjdGlvbnMuaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIC8vaW5zdHJ1Y3Rpb25zLmV2ZW50cy5vbklucHV0VXAuYWRkKHRoaXMuZ290b0luc3RydWN0aW9ucylcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoXCJHYW1lXCIpO1xuICB9LFxuICBnb3RvSW5zdHJ1Y3Rpb25zOiBmdW5jdGlvbigpe1xuICAgIFxuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgxMDAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgIHRoaXMuYXNzZXQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIC8vdGhpcy5sb2FkLmltYWdlKCd0ZXN0c3ByaXRlJywgJ2Fzc2V0cy90ZXN0LnBuZycpO1xuXG4gICAgdGhpcy5sb2FkLnRpbGVtYXAoJ2xldmVsMScsICdhc3NldHMvbWFwcy9maXJzdF9tYXAuanNvbicsIG51bGwsIFBoYXNlci5UaWxlbWFwLlRJTEVEX0pTT04pO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnc2NlbmFyaW9TcHJpdGVzJywgJ2Fzc2V0cy9pbWFnZXMvYmxvY2tMYXllci9zdG9uZV9icmlja3MucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdvYmplY3RzU3ByaXRlcycsICdhc3NldHMvaW1hZ2VzL3dlYXBvbnNfc3BlbGxzX3RvcmNoX2tleV9nZW1zLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnYm94U3ByaXRlJywgJ2Fzc2V0cy9pbWFnZXMvZ3VpL2JveC1oaWdocmVzLnBuZycpO1xuXG4gICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdwbGF5ZXJTcHJpdGVzJywgJ2Fzc2V0cy9pbWFnZXMvcGxheWVycy1tYWdlcy5wbmcnLCAxNiwgMTYpO1xuICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldCgnbW9uc3RlcnNTcHJpdGVzJywgJ2Fzc2V0cy9pbWFnZXMvem9tYmllLnBuZycsIDE2LCAxNik7XG4gICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCd0aW1lcicsICdhc3NldHMvaW1hZ2VzL3RpbWVyLnBuZycsIDE1MCwgMjApO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgICB9XG4gIH0sXG5cbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgfVxufTtcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn07IiwidmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICByb2xsRGljZTogZnVuY3Rpb24obWluLCBtYXgpe1xuICAgIFx0cmV0dXJuIE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pICsgbWluKVxuICAgIH1cblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlsczsiLCJcbnZhciB0aW1lclRpY2sgPSBmdW5jdGlvbigpIHtcblx0XHQvKmpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuXHRcdGlmKCF0aGlzLnRpbWVyKVxuXHRcdFx0cmV0dXJuXG5cdFx0dmFyIG15VGltZSA9ICh0aGlzLnR5cGUgPT0gJ2Rvd24nKSA/IHRoaXMucmVtYWluaW5nVGltZSgpIDogdGhpcy50aW1lci5zZWNvbmRzO1xuXHRcdHRoaXMucmVjdC53aWR0aCA9IE1hdGgubWF4KDAsIChteVRpbWUgLyB0aGlzLnRvdGFsVGltZSkgKiB0aGlzLmZ1bGxXaWR0aCk7XG5cdFx0dGhpcy5zcHJpdGUuY3JvcCh0aGlzLnJlY3QpO1xuXHR9XG5cbnZhciBWaXN1YWxUaW1lciA9IGZ1bmN0aW9uKG9wdHMpIHtcblx0XHR0aGlzLmRlc3Ryb3llZCA9IGZhbHNlXG5cdFx0dGhpcy50eXBlID0gJ2Rvd24nO1xuXHRcdGlmIChvcHRzLnR5cGUpIHtcblx0XHRcdHRoaXMudHlwZSA9IG9wdHMudHlwZTtcblx0XHR9XG5cdFx0dGhpcy50b3RhbFRpbWUgPSBvcHRzLnNlY29uZHM7XG5cdFx0dGhpcy5nYW1lID0gb3B0cy5nYW1lO1xuXHRcdHRoaXMub25Db21wbGV0ZSA9IG9wdHMub25Db21wbGV0ZTtcblx0XHR2YXIga2V5ID0gJ3RpbWVyJztcblx0XHRpZiAob3B0cy5rZXkpIHtcblx0XHRcdGtleSA9IG9wdHMua2V5O1xuXHRcdH1cblx0XHR0aGlzLmVtcHR5ID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoMCwgMCwga2V5LCAxKTtcblx0XHR0aGlzLmVtcHR5LmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuICBcdHRoaXMuZW1wdHkuY2FtZXJhT2Zmc2V0LnNldFRvKG9wdHMueCwgb3B0cy55KTtcblxuXHRcdHRoaXMuc3ByaXRlID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoMCwgMCwga2V5LCAwKTtcblx0XHR0aGlzLnNwcml0ZS5maXhlZFRvQ2FtZXJhID0gdHJ1ZTtcbiAgXHR0aGlzLnNwcml0ZS5jYW1lcmFPZmZzZXQuc2V0VG8ob3B0cy54LCBvcHRzLnkpO1xuXHRcdFxuXHRcdHRoaXMuZnVsbFdpZHRoID0gdGhpcy5zcHJpdGUud2lkdGg7XG5cdFx0dGhpcy5yZXNldCgpO1xuXHR9XG5cblx0VmlzdWFsVGltZXIucHJvdG90eXBlID0ge1xuXHRcdHJlc2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdGNvbnNvbGUubG9nKHRoaXMuZGVzdHJveWVkKVxuXHRcdFx0aWYodGhpcy5kZXN0cm95ZWQpXG5cdFx0XHRcdHJldHVyblxuXG5cdFx0XHRpZiAodGhpcy50aW1lcikge1xuXHRcdFx0XHR0aGlzLnRpbWVyLnN0b3AoKTtcblx0XHRcdH1cblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0dGhpcy5oYXNGaW5pc2hlZCA9IGZhbHNlO1xuXHRcdFx0dGhpcy50aW1lciA9IHRoaXMuZ2FtZS50aW1lLmNyZWF0ZSh0cnVlKTtcblx0XHRcdHRoaXMudGltZXIucmVwZWF0KFBoYXNlci5UaW1lci5TRUNPTkQsIHRoaXMudG90YWxUaW1lLCB0aW1lclRpY2ssIHRoaXMpO1xuXHRcdFx0dGhpcy50aW1lci5vbkNvbXBsZXRlLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi5oYXNGaW5pc2hlZCA9IHRydWU7XG5cdFx0XHRcdGlmIChzZWxmLm9uQ29tcGxldGUpIHtcblx0XHRcdFx0XHRzZWxmLm9uQ29tcGxldGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnJlY3QgPSBuZXcgUGhhc2VyLlJlY3RhbmdsZSgwLCAwLCAwLCB0aGlzLnNwcml0ZS5oZWlnaHQpO1xuXHRcdFx0aWYgKHRoaXMudHlwZSA9PSAnZG93bicpIHtcblx0XHRcdFx0dGhpcy5zcHJpdGUuY3JvcChudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuc3ByaXRlLmNyb3AodGhpcy5yZWN0KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0ZGVzdHJveTogZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMudGltZXIgPSBudWxsXG5cdFx0XHR0aGlzLmRlc3Ryb3llZCA9IHRydWVcblxuXHRcdFx0dGhpcy5zcHJpdGUuZGVzdHJveSgpXG5cdFx0XHR0aGlzLmVtcHR5LmRlc3Ryb3koKVxuXHRcdH0sXG5cblx0XHRzZXRUaW1lOiBmdW5jdGlvbihzZWNvbmRzKSB7XG5cdFx0XHR0aGlzLnRvdGFsVGltZSA9IHNlY29uZHM7XG5cdFx0XHR0aGlzLnJlc2V0KCk7XG5cdFx0fSxcblxuXHRcdHN0YXJ0OiBmdW5jdGlvbigpIHtcblx0XHRcdGlmKHRoaXMuZGVzdHJveWVkKVxuXHRcdFx0XHRyZXR1cm5cblx0XHRcdHRoaXMucmVzZXQoKTtcblx0XHRcdHRoaXMudGltZXIuc3RhcnQoKTtcblx0XHR9LFxuXG5cdFx0c3RvcDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnRpbWVyLnN0b3AoKTtcblx0XHR9LFxuXG5cdFx0cGF1c2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy50aW1lci5wYXVzZSgpO1xuXHRcdH0sXG5cblx0XHRyZXN1bWU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy50aW1lci5yZXN1bWUoKTtcblx0XHR9LFxuXG5cdFx0cmVtYWluaW5nVGltZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy50b3RhbFRpbWUgLSB0aGlzLnRpbWVyLnNlY29uZHM7XG5cdFx0fVxuXHR9O1xuXG5cblx0XG5cblxubW9kdWxlLmV4cG9ydHMgPSBWaXN1YWxUaW1lcjtcbiJdfQ==
